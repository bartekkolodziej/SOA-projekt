<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
    <style type="text/css">
        li {
            margin: 8px;
        }
    </style>
    <f:verbatim>
        <script type="text/javascript" language="JavaScript">

        </script>
    </f:verbatim>
</h:head>
<h:body>
    <div id="menu">
        <h1>Menu</h1>
        <ol>
            <ui:repeat value="#{MenuController.categories}" var="category">
                <li>
                    <div style="display: flex; justify-content:space-between; width: 200px; border: 1px solid grey; padding: 8px">
                        #{category.name}
                        <h:form>
                            <h:commandButton action="#{CategoryController.redirectToCategoryPage(category)}"
                                             rendered="#{ApplicationController.getInstance().loggedUser.role.equals('manager') ||
                                                     ApplicationController.getInstance().loggedUser.role.equals('admin')}"
                                             value="Add"/>
                            <h:commandButton action="#{CategoryController.removeCategory(category.id)}"
                                             rendered="#{ApplicationController.getInstance().loggedUser.role.equals('manager') ||
                                                     ApplicationController.getInstance().loggedUser.role.equals('admin')}"
                                             value="Remove">
                                <f:actionListener binding="#{MenuController.getCategoriesFromDB()}"/>
                            </h:commandButton>
                        </h:form>
                    </div>
                    <ul>
                        <ui:repeat value="#{category.dishes}" var="dish">
                            <li style="display: flex; justify-content:space-between; width: 400px; border: 1px solid grey; padding: 8px">
                                <div>Dish: #{dish.name} <br/>
                                    Weight: #{dish.weight} <br/>
                                    Price #{dish.price} <br/>
                                </div>
                                <h:form>
                                    <h:commandButton action="#{BillController.addDishToCart(dish)}"
                                                     rendered="#{ApplicationController.getInstance().loggedUser.role.equals('client')}"
                                                     value="Add to cart"/><br/>
                                    <h:commandButton action="#{DishController.redirectToDishPage(dish)}"
                                                     rendered="#{ApplicationController.getInstance().loggedUser.role.equals('manager') ||
                                                     ApplicationController.getInstance().loggedUser.role.equals('admin')}"
                                                     value="Edit"/> <br/>
                                    <h:commandButton action="#{DishController.removeDish(dish.id)}"
                                                     rendered="#{ApplicationController.getInstance().loggedUser.role.equals('manager') ||
                                                     ApplicationController.getInstance().loggedUser.role.equals('admin')}"
                                                     value="Remove">
                                        <f:actionListener binding="#{MenuController.getCategoriesFromDB()}"/>
                                    </h:commandButton>
                                    <br/>
                                </h:form>
                            </li>
                        </ui:repeat>
                    </ul>
                </li>
            </ui:repeat>
        </ol>
    </div>

    <div id="editButtons">
        <h:form>
            <h:commandButton action="#{CategoryController.redirectToCategoryPage(null)}" value="Add new category"/>
            <br/>
            <h:commandButton action="#{DishController.redirectToDishPage(null)}" value="Add new dish"/> <br/>
        </h:form>
    </div>


    <div style="position: absolute; top: 0; right: 0; margin: 16px">
        <h:panelGroup layout="block" rendered="#{ApplicationController.getInstance().loggedUser == null}">
            <h:form>
                <h:commandButton action="#{UserController.redirectToUserPage('login')}" value="Login"/> <br/>
                <h:commandButton action="#{UserController.redirectToUserPage('register')}" value="Register"/> <br/>
            </h:form>
        </h:panelGroup>

        <h:panelGroup layout="block"
                      rendered="#{ApplicationController.getInstance().loginAndRegistrationStatus != null}">
            <h:outputText value="#{ApplicationController.getInstance().loginAndRegistrationStatus}"/> <br/>
            <h:form>
                <h:commandButton action="#{ApplicationController.getInstance().logout()}" value="Logout"/>
            </h:form>
        </h:panelGroup>
    </div>

    <h:panelGroup layout="block" rendered="#{ApplicationController.getInstance().loggedUser.role.equals('client')}" >
        <h2>Cart</h2>
        <ol>
            <ui:repeat value="#{BillController.dishesInCart}" var="dishInCart">
                <li style="display: flex; justify-content:space-between; width: 400px; border: 1px solid grey; padding: 8px">
                    Dish: #{dishInCart.name} <br/>
                    Weight: #{dishInCart.weight} <br/>
                    Price #{dishInCart.price} <br/>
                </li>
            </ui:repeat>
        </ol>
        <br/>
        Final price: #{BillController.finalValue} <br/>
        <h:form>
            <h:commandButton action="#{BillController.order()}" value="Order"/>
        </h:form>
    </h:panelGroup>

</h:body>
</html>
